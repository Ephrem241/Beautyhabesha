generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum EscortStatus {
  pending
  approved
  rejected
  suspended
}

model User {
  id                  String         @id @default(cuid())
  email               String         @unique
  password            String?
  name                String?
  role                String         @default("user")
  currentPlan         String?        @default("Normal")
  subscriptionStartDate DateTime?
  subscriptionEndDate   DateTime?
  subscriptionStatus    String?        @default("inactive")
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  escortProfile       EscortProfile?
  subscriptions       Subscription[]

  @@index([subscriptionEndDate])
  @@index([subscriptionStatus])
  @@map("users")
}

model EscortProfile {
  id          String       @id @default(cuid())
  userId      String       @unique
  displayName String
  bio         String?
  city        String?
  images      Json         @default("[]")
  phone       String?
  telegram    String?
  whatsapp    String?
  status      EscortStatus @default(pending)
  approvedAt  DateTime?
  approvedBy  String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status, createdAt(sort: Desc)])
  @@map("escort_profiles")
}

model Plan {
  id           String   @id @default(cuid())
  name         String   @unique
  price        Float
  durationDays Int
  features     String[]
  priority     Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("plans")
}

model Subscription {
  id                   String    @id @default(cuid())
  userId               String
  planId               String
  status               String    @default("pending")
  paymentMethod        String
  paymentProofUrl      String
  paymentProofPublicId String
  rejectionReason      String?
  approvedAt           DateTime?
  startDate            DateTime?
  endDate              DateTime?
  lastNotifiedAt       DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  user                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status, endDate])
  @@index([userId, status])
  @@map("subscriptions")
}
